(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{47943:function(){},55024:function(){},15706:function(e,t,n){Promise.resolve().then(n.bind(n,47104)),Promise.resolve().then(n.bind(n,87290)),Promise.resolve().then(n.bind(n,90541)),Promise.resolve().then(n.bind(n,15167)),Promise.resolve().then(n.bind(n,63776))},47104:function(e,t,n){"use strict";n.r(t);var r=n(57437),i=n(67245),l=n(14703),s=n(30415),d=n.n(s);function Changes(){let{changes:e,isLoading:t,isValidating:n,mutate:s}=(0,i.lx)(),d=(0,i.VW)();return(0,r.jsx)("section",{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Разница расчетного и текущего:"}),(null==e?void 0:e.length)>0?(0,r.jsxs)("table",{cellSpacing:"16px",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Аккаунт"}),(0,r.jsx)("th",{children:"Вес голоса"}),(0,r.jsx)("th",{children:"Изменения"})]})}),(0,r.jsx)("tbody",{children:null==e?void 0:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,l.r)(e.id)}),(0,r.jsx)("td",{children:e.weight}),(0,r.jsx)("td",{children:e.diff})]},e.id))})]}):"Нет изменений",t||n?(0,r.jsx)("div",{children:"Загрузка..."}):(0,r.jsx)("button",{onClick:()=>s(),style:{width:"320px",height:"32px",margin:"16px"},children:"Обновить"}),d&&(0,r.jsx)("p",{style:{width:"600px",wordWrap:"break-word"},children:d.toXDR().toString("base64")})]})})}t.default=d()(()=>Promise.resolve(Changes),{ssr:!1})},87290:function(e,t,n){"use strict";n.r(t);var r=n(57437),i=n(67245),l=n(14703),s=n(30415),d=n.n(s);function CurrentC(){let{currentC:e,error:t,mutate:n,isLoading:s,isValidating:d}=(0,i.vP)();return(0,r.jsx)("section",{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Актуальный состав Совета"}),(s||d)&&(0,r.jsx)("div",{children:"Загрузка..."}),(0,r.jsxs)("table",{cellSpacing:"16px",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Аккаунт"}),(0,r.jsx)("th",{children:"Голоса"})]})}),(0,r.jsx)("tbody",{children:null==e?void 0:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,l.r)(e.id)}),(0,r.jsx)("td",{children:e.count})]},e.id))})]})]})})}t.default=d()(()=>Promise.resolve(CurrentC),{ssr:!1})},90541:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=n(57437),i=n(14703),l=n(45266);let Tree=e=>{var t;let{member:n}=e,s=(0,l.z)(n);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("li",{children:(0,r.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[(0,i.r)(n.id)," ",s-n.count>0?s+" = "+n.count+" + "+(s-n.count):s]})},n.id),!!(null===(t=n.children)||void 0===t?void 0:t.length)&&(0,r.jsx)("ul",{children:n.children.map(e=>(0,r.jsx)(Tree,{member:e},"".concat(e.id,"_children")))},"".concat(n.id,"_children"))]})};var s=n(67245),d=n(30415);function DelegateTree(){var e,t;let{tree:n,isLoading:i,isValidating:d,mutate:a,error:c}=(0,s.Aj)();return(0,r.jsx)("section",{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Проверка делегаций для Совета:"}),(i||d)&&(0,r.jsx)("div",{children:"Загрузка..."}),(0,r.jsx)("ul",{children:null==n?void 0:null===(t=n.map(e=>({...e,delegations:(0,l.z)(e)})))||void 0===t?void 0:null===(e=t.sort((e,t)=>t.delegations-e.delegations||e.id.localeCompare(t.id)))||void 0===e?void 0:e.map((e,t)=>(0,r.jsxs)("div",{children:[e.count>0?(0,r.jsx)(Tree,{member:e},e.id):null,19===t&&(0,r.jsx)("hr",{})]},e.id))},"tree"),c&&(0,r.jsx)("div",{style:{color:"red"},children:c()})]})})}var a=n.n(d)()(()=>Promise.resolve(DelegateTree),{ssr:!1})},14703:function(e,t,n){"use strict";n.d(t,{r:function(){return Link}});var r=n(57437);let Link=e=>e?(0,r.jsx)("a",{href:"https://stellar.expert/explorer/public/account/".concat(e),target:"_blank",className:"stellar_address",children:e.replace(e.substring(4,e.length-4),"...")}):null},15167:function(e,t,n){"use strict";n.r(t);var r=n(57437),i=n(67245),l=n(14703),s=n(30415),d=n.n(s);function Members(){var e;let{members:t,isLoading:n,isValidating:s,mutate:d}=(0,i.Y5)();return(0,r.jsx)("section",{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Индивидуальные участники Ассоциации"}),(n||s)&&(0,r.jsx)("div",{children:"Загрузка..."}),(0,r.jsxs)("table",{cellSpacing:"16px",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Аккаунт"}),(0,r.jsx)("th",{children:"MTLAP"}),(0,r.jsx)("th",{children:"Делегат в Собрании"}),(0,r.jsx)("th",{children:"Делегат в Совете"})]})}),(0,r.jsx)("tbody",{children:null==t?void 0:null===(e=t.sort((e,t)=>t.count-e.count||e.id.localeCompare(t.id)))||void 0===e?void 0:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,l.r)(e.id)}),(0,r.jsx)("td",{children:e.count}),(0,r.jsx)("td",{children:(0,l.r)(e.delegateA)}),(0,r.jsx)("td",{children:(0,l.r)(e.delegateC)})]},e.id))})]})]})})}t.default=d()(()=>Promise.resolve(Members),{ssr:!1})},63776:function(e,t,n){"use strict";n.r(t);var r=n(57437),i=n(14703),l=n(67245),s=n(30415),d=n.n(s);function NewC(){let{newC:e,isLoading:t,isValidating:n,mutate:s}=(0,l.Wt)();return(0,r.jsx)("section",{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Ожидаемый состав Совета"}),(t||n)&&(0,r.jsx)("div",{children:"Загрузка..."}),(0,r.jsxs)("table",{cellSpacing:"16px",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Аккаунт"}),(0,r.jsx)("th",{children:"Токены"}),(0,r.jsx)("th",{children:"Голоса"})]})}),(0,r.jsx)("tbody",{children:null==e?void 0:e.map(e=>{var t,n;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,i.r)(e.id)}),(0,r.jsx)("td",{children:null!==(t=e.delegations)&&void 0!==t&&t?e.count+" = "+(e.count-(null!==(n=e.delegations)&&void 0!==n?n:0))+" + "+e.delegations:e.count}),(0,r.jsx)("td",{children:e.weight})]},e.id)})})]})]})})}t.default=d()(()=>Promise.resolve(NewC),{ssr:!1})},67245:function(e,t,n){"use strict";n.d(t,{lx:function(){return useGetChanges},vP:function(){return useGetCurrentC},Y5:function(){return useGetMembers},Wt:function(){return useGetNewC},VW:function(){return useGetTransaction},Aj:function(){return useGetTree}});var r=n(57437),i=n(69108),l=n(42333);let s={mainAccount:"GCNVDZIHGX473FEI7IXCUAEXUJ4BGCKEMHF36VYP5EMS7PX2QBLAMTLA",mtlapToken:"MTLAP"};var d=n(7006),a=n.n(d),c=n(30954),o=n.n(c),u=n(47520),h=n.n(u),x=n(48911),m=n.n(x),v=n(83705),g=n.n(v),j=n(92166),f=n(45266),p=n(14703),b=n(2265);let C=new i.Server("https://horizon.stellar.org"),w=new i.Asset(s.mtlapToken,s.mainAccount),useGetCurrentC=()=>{let e=(0,l.ZP)("currentC",()=>C.loadAccount(s.mainAccount),{revalidateOnFocus:!1}),{data:t,error:n,mutate:r,isLoading:i,isValidating:d}=e;return{currentC:null==t?void 0:t.signers.filter(e=>e.key!==s.mainAccount).map(e=>({id:e.key,count:e.weight})).sort((e,t)=>t.count-e.count),error:n,mutate:r,isLoading:i,isValidating:d}},asyncWhile=async(e,t)=>{var n;let r=await t();return(e=e.concat(null==r?void 0:r.records),(null==r?void 0:null===(n=r.records)||void 0===n?void 0:n.length)>0)?await asyncWhile(e,r.next):e},useGetMembers=()=>{let e=(0,l.ZP)("members",async()=>{let e=[],t=await C.accounts().forAsset(w).call();return e.concat(t.records,await asyncWhile(e,t.next))},{revalidateOnFocus:!1}),[t,n]=(0,b.useState)([]),[r,i]=(0,b.useState)([]);return(0,b.useEffect)(()=>{var t;let r=[],l=[];null==e||null===(t=e.data)||void 0===t||t.forEach(e=>{var t;let n=atob(e.data_attr.mtla_a_delegate||e.data_attr.mtla_delegate||""),i=atob(e.data_attr.mtla_c_delegate||e.data_attr.mtla_delegate||"");""!==n&&l.push(n),""!==i&&l.push(i),r.push({id:e.account_id,count:Number((null===(t=e.balances.find(e=>"credit_alphanum12"===e.asset_type&&e.asset_code===w.getCode()&&e.asset_issuer===w.getIssuer()))||void 0===t?void 0:t.balance)||0),delegateA:n,delegateC:i})}),n(r),i(l)},[e.data]),(0,b.useEffect)(()=>{(async()=>{let e=o()(m()(r),t,(e,t)=>e===t.id);(null==e?void 0:e.length)>0&&n(await enrichMembers(g()(t,"id"),e,10))})()},[t]),{data:e.data,isLoading:e.isLoading,isValidating:e.isValidating,mutate:e.mutate,members:t}},useGetTree=()=>{let e;let{members:t,isLoading:n,isValidating:i,mutate:l}=useGetMembers(),s=(0,j.arrayToTree)(t,{parentId:"delegateC",dataField:null});try{(0,j.arrayToTree)(t,{parentId:"delegateC",dataField:null,throwIfOrphans:!0})}catch(n){var d;let t=null===(d=/\[(.+?)\]/.exec(n))||void 0===d?void 0:d[1];e=()=>(0,r.jsxs)(r.Fragment,{children:["В делигациях есть циклические ссылки или ссылки на недействительных участников",t?(0,r.jsxs)(r.Fragment,{children:[" (",(0,p.r)(t),")"]}):"","!"]})}return{tree:s,isLoading:n,isValidating:i,mutate:l,error:e}},useGetNewC=()=>{let{tree:e,isLoading:t,isValidating:n,mutate:r}=useGetTree(),i=e.filter(e=>e.count>0).map(e=>({...e,count:(0,f.z)(e),delegations:(0,f.z)(e)-e.count,weight:Math.floor(Math.log10(Math.max((0,f.z)(e),2)-1)+1)})).splice(0,20).sort((e,t)=>t.count-e.count||e.id.localeCompare(t.id));return{newC:i,isLoading:t,isValidating:n,mutate:r}},useGetChanges=()=>{let{currentC:e=[],mutate:t,isLoading:n,isValidating:r}=useGetCurrentC(),{newC:i,isLoading:l,isValidating:s,mutate:d}=useGetNewC(),c={},o=a()(e,i,"id");o.forEach(e=>c[e.id]=0);let u=a()(i,e,"id");u.forEach(e=>c[e.id]=e.weight);let x=h()(i,e,(e,t)=>e.id===t.id&&e.weight!==t.count);x.forEach(e=>c[e.id]=e.weight);let m=e.reduce((e,t)=>({...e,[t.id]:t.count}),{});return{changes:Object.keys(c).map(e=>{var t;let n=null!==(t=m[e])&&void 0!==t?t:0,r=c[e];return{id:e,weight:r,diff:0===n?"новый":r<n?"- ".concat(n-r):"+ ".concat(r-n)}}),isLoading:l||n,isValidating:s||r,mutate:()=>{Promise.all([d(),t()])}}},enrichMembers=async(e,t,n)=>{let r=[...e],i=[];if(n>0&&(null==t?void 0:t.length)>0){(await Promise.all(t.map(async e=>{let t=await C.loadAccount(e),n=atob(t.data_attr.mtla_a_delegate||t.data_attr.mtla_delegate||""),r=atob(t.data_attr.mtla_c_delegate||t.data_attr.mtla_delegate||"");return""!==n&&i.push(n),""!==r&&i.push(r),{id:e,count:0,delegateA:n,delegateC:r}}))).forEach(e=>r.push(e));let e=o()(m()(i),r,(e,t)=>e===t.id);(null==e?void 0:e.length)>0&&(r=await enrichMembers(r,e,n-1))}return r},useGetTransaction=()=>{let{newC:e}=useGetNewC(),{changes:t}=useGetChanges(),n=(0,l.ZP)("currentC",()=>C.loadAccount(s.mainAccount),{revalidateOnFocus:!1}),r=e.reduce((e,t)=>e+t.weight,0),d=Math.floor(r/2+1);if(n.data){let e=new i.TransactionBuilder(n.data,{fee:"100000",networkPassphrase:i.Networks.PUBLIC});e.addMemo(i.Memo.text("Update sign weights"));let r=0,l=t[t.length-1];if(t.forEach(t=>{let n=i.Operation.setOptions({signer:{ed25519PublicKey:i.Keypair.fromPublicKey(t.id).publicKey(),weight:t.weight},...l.id===t.id&&{masterWeight:0,lowThreshold:d,medThreshold:d,highThreshold:d}});e.addOperation(n),r++}),r)return e.setTimeout(30).build().toEnvelope()}return null}},45266:function(e,t,n){"use strict";n.d(t,{z:function(){return sumCount}});let sumCount=e=>{var t,n;return e?e.count+ +((null===(t=e.children)||void 0===t?void 0:t.length)?null===(n=e.children)||void 0===n?void 0:n.map(sumCount).reduce((e,t)=>e+t,0):0):0}}},function(e){e.O(0,[638,668,971,864,744],function(){return e(e.s=15706)}),_N_E=e.O()}]);